<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Profil - FEEL FOOD</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #ff5722; --bg: #f8f9fa; --text-dark: #1a1a1a; --font-main: 'Inter', sans-serif; --font-logo: 'Poppins', sans-serif; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            background: var(--bg); margin: 0; padding: 25px 15px 120px 15px; 
            min-height: 100vh; font-family: var(--font-main); color: var(--text-dark);
            -webkit-overflow-scrolling: touch;
        }

        h2 { font-family: var(--font-logo); font-weight: 800; font-size: 28px; margin-bottom: 25px; margin-top: 10px; }

        /* PROFILE CARD */
        .profile-card { 
            background: white; padding: 22px; border-radius: 28px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.03); margin-bottom: 20px; 
            display: flex; align-items: center; gap: 18px;
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .user-avatar { 
            width: 65px; height: 65px; background: linear-gradient(135deg, var(--primary), #ff8a65); 
            border-radius: 22px; display: flex; align-items: center; justify-content: center; 
            font-size: 30px; color: white; box-shadow: 0 8px 15px rgba(255,87,34,0.1);
            overflow: hidden;
        }
        .user-details b { font-size: 18px; display: block; margin-bottom: 4px; }
        .user-details small { color: #8e8e93; font-weight: 500; font-size: 14px; }

        /* SETTINGS CARD */
        .settings-card { 
            background: white; padding: 22px; border-radius: 28px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.03); margin-bottom: 15px;
        }
        .settings-title { 
            font-weight: 700; margin-bottom: 18px; display: block; 
            color: #8e8e93; font-size: 12px; text-transform: uppercase; 
            letter-spacing: 1px; 
        }
        
        .lang-options { display: flex; flex-direction: column; gap: 12px; }
        .lang-btn { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 16px; border-radius: 18px; border: 2px solid #f8f9fa; 
            background: #f8f9fa; cursor: pointer; transition: 0.3s;
        }
        .lang-btn.active { border-color: var(--primary); background: white; }
        .lang-btn.active b { color: var(--primary); }
        .check-mark { 
            width: 22px; height: 22px; background: var(--primary); 
            color: white; border-radius: 50%; display: none; 
            align-items: center; justify-content: center; font-size: 10px; 
        }
        .lang-btn.active .check-mark { display: flex; }

        /* LOGOUT BUTTON */
        .logout-btn {
            width: 100%; padding: 18px; border-radius: 22px; border: none;
            background: #fff0ed; color: #ff3b30; font-weight: 700;
            margin-top: 10px; cursor: pointer; transition: 0.2s;
        }

        /* NAVBAR */
        .navbar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(15px);
            height: 70px; display: flex; justify-content: space-around; align-items: center; 
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 1000; 
            border-radius: 25px 25px 0 0;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { 
            display: flex; flex-direction: column; align-items: center; 
            text-decoration: none; color: #adb5bd; flex: 1; transition: 0.3s;
        }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 22px; margin-bottom: 4px; position: relative; }
        .nav-text { font-size: 11px; font-weight: 700; }
        .badge { 
            position: absolute; top: -5px; right: -10px; background: #ff3b30; color: white; 
            font-size: 10px; width: 17px; height: 17px; border-radius: 50%; 
            border: 2px solid white; display: none; align-items: center; 
            justify-content: center; font-weight: 800; 
        }
    </style>
</head>
<body>

    <h2 id="page-title">Profil</h2>

    <div class="profile-card">
        <div class="user-avatar" id="avatar-icon">üë§</div>
        <div class="user-details">
            <b id="user-name">Mijoz</b>
            <small id="user-phone">Yuborilmagan</small>
        </div>
    </div>

    <div class="settings-card">
        <span class="settings-title" id="lang-title">Ilova tili</span>
        <div class="lang-options">
            <div class="lang-btn" id="btn-uz" onclick="changeLanguage('uz')">
                <span>üá∫üáø <b>O'zbekcha</b></span>
                <div class="check-mark">‚úì</div>
            </div>
            <div class="lang-btn" id="btn-ru" onclick="changeLanguage('ru')">
                <span>üá∑üá∫ <b>–†—É—Å—Å–∫–∏–π</b></span>
                <div class="check-mark">‚úì</div>
            </div>
        </div>
    </div>

    <button class="logout-btn" id="logout-text" onclick="logout()">Hisobdan chiqish</button>

    <nav class="navbar">
        <a href="index.html" class="nav-item" onclick="navHaptic()">
            <span class="nav-icon">üè†</span>
            <span class="nav-text nav-text-home">Asosiy</span>
        </a>
        <a href="cart.html" class="nav-item" onclick="navHaptic()">
            <span class="nav-icon">üõí<span class="badge" id="cart-badge">0</span></span>
            <span class="nav-text nav-text-cart">Savat</span>
        </a>
        <a href="profile.html" class="nav-item active" onclick="navHaptic()">
            <span class="nav-icon">üë§</span>
            <span class="nav-text nav-text-profile">Profil</span>
        </a>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const translations = {
            uz: { title: "Profil", langTitle: "Ilova tili", home: "Asosiy", cart: "Savat", profile: "Profil", logout: "Hisobdan chiqish", confirmLogout: "Haqiqatan ham chiqmoqchimisiz?" },
            ru: { title: "–ü—Ä–æ—Ñ–∏–ª—å", langTitle: "–Ø–∑—ã–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è", home: "–ì–ª–∞–≤–Ω–∞—è", cart: "–ö–æ—Ä–∑–∏–Ω–∞", profile: "–ü—Ä–æ—Ñ–∏–ª—å", logout: "–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞", confirmLogout: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?" }
        };

        function navHaptic() {
            tg.HapticFeedback.impactOccurred('medium');
        }

        function changeLanguage(lang) {
            localStorage.setItem('selectedLang', lang);
            tg.HapticFeedback.selectionChanged();
            applyLanguage(lang);
            // Sahifani yangilash shart emas, lekin Index sahifasiga o'tganda tillar o'zgargan bo'ladi
        }

        function applyLanguage(lang) {
            const t = translations[lang];
            document.getElementById('page-title').innerText = t.title;
            document.getElementById('lang-title').innerText = t.langTitle;
            document.getElementById('logout-text').innerText = t.logout;
            document.querySelector('.nav-text-home').innerText = t.home;
            document.querySelector('.nav-text-cart').innerText = t.cart;
            document.querySelector('.nav-text-profile').innerText = t.profile;

            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + lang).classList.add('active');
        }

        function updateBadge() {
            const cart = JSON.parse(localStorage.getItem('cart')) || {};
            const count = Object.values(cart).reduce((a, b) => a + b, 0);
            const b = document.getElementById('cart-badge');
            if(b) { 
                b.innerText = count; 
                b.style.display = count > 0 ? 'flex' : 'none'; 
            }
        }

        function logout() {
            const lang = localStorage.getItem('selectedLang') || 'uz';
            tg.showConfirm(translations[lang].confirmLogout, (ok) => {
                if (ok) {
                    localStorage.removeItem('userData');
                    localStorage.removeItem('cart');
                    window.location.href = 'index.html';
                }
            });
        }

        function loadUserInfo() {
            const localData = JSON.parse(localStorage.getItem('userData'));
            const tgUser = tg.initDataUnsafe?.user;

            if (tgUser) {
                document.getElementById('user-name').innerText = tgUser.first_name + (tgUser.last_name ? " " + tgUser.last_name : "");
                document.getElementById('user-phone').innerText = tgUser.username ? "@" + tgUser.username : (localData?.phone || "Raqam yo'q");
                
                if (tgUser.photo_url) {
                    const avatar = document.getElementById('avatar-icon');
                    avatar.innerHTML = `<img src="${tgUser.photo_url}" style="width:100%; height:100%; border-radius:inherit; object-fit:cover;">`;
                }
            } else if (localData) {
                document.getElementById('user-name').innerText = localData.name;
                document.getElementById('user-phone').innerText = localData.phone;
            }
        }

        window.onload = () => {
            const savedLang = localStorage.getItem('selectedLang') || 'uz';
            applyLanguage(savedLang);
            loadUserInfo();
            updateBadge();
        };
    </script>
</body>
</html>